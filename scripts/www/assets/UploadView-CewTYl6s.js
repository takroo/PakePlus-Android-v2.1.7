import"./Request-BS-OXrG0.js";/* empty css                 */import{u as C}from"./MediaApi-gtrj6E5_.js";import{_ as L,r as y,o as S,B as R,C as E,c as r,a as s,b as n,t as p,w as u,O as F,h as V,d as M,q as N,T as D,i as d,u as v,P as O,j as k,Q as j,G as A,F as G,f as q,e as b,R as P,S as J,U as K,A as B}from"./index-BleZNwfK.js";const Q={class:"media-upload-container"},W={class:"stats-bar",style:{display:"flex","flex-direction":"column"}},$={class:"stats-bar"},H={class:"stat-item"},X={class:"stat-item"},Y={class:"stat-item"},Z={class:"media-content"},I={key:0,class:"empty-state"},ee=["onClick"],se={key:1},te=["src"],ae={key:2,class:"video-thumbnail"},oe=["poster"],le=["src","type"],ne={class:"media-info"},de={class:"media-name"},ce={class:"media-meta"},ie={key:0},re={key:3,class:"progress-overlay"},ue={key:1,class:"success-tip"},pe={__name:"UploadView",setup(_e){const w=y({});S(()=>{const e=decodeURIComponent(R().query.album);w.value=JSON.parse(e)});const c=y([]),h=E(()=>{const e=c.value.filter(l=>l.type==="image").length,t=c.value.filter(l=>l.type==="video").length,o=c.value.reduce((l,i)=>l+i.size,0);return{images:e,videos:t,totalSize:o}}),x=e=>{const t=e.raw.type.startsWith("image/")?"image":"video",o={id:Date.now()+Math.random(),name:e.name,type:t,size:e.raw.size,mimeType:e.raw.type,url:URL.createObjectURL(e.raw),file:e.raw,thumbnail:t==="image"?URL.createObjectURL(e.raw):null,uploading:!1,progress:0,success:!1,speed:0};c.value.unshift(o)},z=e=>{c.value=c.value.filter(t=>t.id!==e)},f=e=>{if(e===0)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,l)).toFixed(2))+" "+o[l]},g=y(0),T=()=>{g.value=c.value.length,c.value.forEach(e=>{U(e)})},U=async e=>{e.uploading=!0;try{let t=Date.now(),o=0,l=t;C(w.value.albumId,e.file,i=>{e.progress=Math.round(i.loaded*100/i.total);const _=Date.now(),m=(_-l)/1e3,a=i.loaded-o;e.speed=m>0?a/m:0,o=i.loaded,l=_}).then(i=>{i.data.code===200?(e.success=!0,g.value--,g.value===0&&B.success("上传完成")):B.error(i.data.message)})}catch(t){console.error("上传失败:",t),e.progress=0,e.uploading=!1}};return(e,t)=>{const o=N,l=F,i=V,_=A,m=J;return d(),r("div",Q,[s("div",W,[s("div",$,[s("div",H,[s("span",null,"照片: "+p(h.value.images)+"张",1)]),s("div",X,[s("span",null,"视频: "+p(h.value.videos)+"个",1)]),s("div",Y,[s("span",null,"总大小: "+p(f(h.value.totalSize)),1)])]),n(l,{class:"upload-card",drag:"",multiple:"",action:"#","auto-upload":!1,"on-change":x,"show-file-list":!1,accept:"image/*,video/*"},{default:u(()=>[n(o,{class:"el-icon--upload"},{default:u(()=>[n(v(O))]),_:1}),t[0]||(t[0]=s("div",{class:"el-upload__text"},[k(" 拖动到这或"),s("em",null,"点击上传")],-1))]),_:1,__:[0]}),n(i,{disabled:c.value.length===0,onClick:T,type:"primary",style:{height:"40px"}},{default:u(()=>[n(o,null,{default:u(()=>[n(v(j))]),_:1}),t[1]||(t[1]=k(" 上传 "))]),_:1,__:[1]},8,["disabled"])]),s("div",Z,[c.value.length===0?(d(),r("div",I,[n(o,{size:"10"},{default:u(()=>[n(_,{"image-size":"100"})]),_:1})])):(d(),M(D,{key:1,name:"fade",tag:"div",class:"media-grid"},{default:u(()=>[(d(!0),r(G,null,q(c.value,a=>(d(),r("div",{class:"media-item",key:a.id},[a.success?b("",!0):(d(),r("button",{key:0,class:"delete-btn",onClick:me=>z(a.id)},[n(o,null,{default:u(()=>[n(v(P))]),_:1})],8,ee)),a.type==="image"?(d(),r("div",se,[s("img",{src:a.url,class:"media-thumbnail",alt:"图片预览"},null,8,te)])):(d(),r("div",ae,[s("video",{class:"media-thumbnail",poster:a.thumbnail},[s("source",{src:a.url,type:a.mimeType},null,8,le)],8,oe)])),s("div",ne,[s("div",de,p(a.name),1),s("div",ce,[s("div",null,[s("span",null,p(a.type==="image"?"图片":"视频"),1),s("span",null,"("+p(f(a.size))+")",1)]),a.success?b("",!0):(d(),r("div",ie,[s("span",null,p(f(a.speed))+"/s",1)]))])]),a.uploading?(d(),r("div",re,[a.success?(d(),r("div",ue,[n(o,null,{default:u(()=>[n(v(K))]),_:1}),t[2]||(t[2]=k(" 上传完成 "))])):(d(),M(m,{key:0,percentage:a.progress,width:60,"text-inside":!0,"stroke-width":22,class:"progress"},null,8,["percentage"]))])):b("",!0)]))),128))]),_:1}))])])}}},ye=L(pe,[["__scopeId","data-v-fbc6efeb"]]);export{ye as default};
