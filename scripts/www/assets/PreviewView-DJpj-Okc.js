import"./Request-BS-OXrG0.js";import{a as L,s as W,d as j,c as R,e as S,b as G}from"./MediaApi-gtrj6E5_.js";import{_ as H,o as K,B as C,r as w,V as X,C as b,c as g,a as i,j as $,t as A,b as l,w as d,h as Y,e as Z,n as V,q as J,u as p,z as O,A as c,H as z,i as y,W as Q,R as ee,X as te,Y as ae,Z as se,$ as le}from"./index-BleZNwfK.js";const ne={class:"preview-modal"},oe={class:"preview-header"},ie={style:{color:"white","justify-content":"left"}},de={style:{"font-size":"10px"}},re={class:"preview-main"},ce=["src","alt"],ue=["src"],ve=["src"],pe=["src"],me={__name:"PreviewView",setup(fe){K(()=>{const t=C().query.selectedMedia;f.value=C().query.albumId,document.body.classList.add("preview-page-active"),L(f.value).then(e=>{u.value=e.data,q(t)})}),X(()=>{document.body.classList.remove("preview-page-active")});const u=w([]),f=w(null),n=w(null),s=b(()=>n.value===null?null:u.value[n.value]),E=async()=>{const t=s.value;c.success(`开始下载 ${s.value.name} `);try{const e=I(t.mediaId),a=document.createElement("a");a.href=e,a.download=t.name||"file",a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a),a.addEventListener("load",()=>{c.success("下载完成")})}catch(e){c.error(`"${t.description||"文件"}" 下载失败`),console.error("下载出错:",e)}},P=()=>{z.confirm(`确定要删除 ${s.value.name} 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{j([s.value.mediaId],f.value).then(t=>{t.code===200?(c.success("删除成功"),M(),u.value=u.value.filter(e=>e.mediaId!==s.mediaId)):c.error(t.message)})}).catch(()=>{})},U=()=>{const t=s.value;z.prompt("请输入新的描述","编辑描述",{confirmButtonText:"保存",cancelButtonText:"取消",inputValue:t.description||""}).then(({value:e})=>{R(t.mediaId,e).then(a=>{a.code===200?(c.success("修改成功"),t.description=e):c.error(a.message)})}).catch(()=>{})},D=()=>{n.value>0?n.value--:n.value=u.value.length-1},M=()=>{n.value<u.value.length-1?n.value++:n.value=0},h=t=>S(t),I=t=>G(t),T=()=>{W(f.value,s.value.mediaId).then(t=>{t.code===200?c.success("更新成功"):c.error(t.message)})},N=t=>{if(t===0)return"0 Bytes";const e=1024,a=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,r)).toFixed(2))+" "+a[r]},q=t=>{n.value=u.value.findIndex(e=>e.mediaId===t)},F=w(window.innerWidth);return b(()=>((e,a,r=7)=>{const m=Math.floor(r/2);let o=a-m,v=a+m+1;return o<0&&(v+=Math.abs(o),o=0),v>e.length&&(o-=v-e.length,v=e.length,o=Math.max(o,0)),e.slice(o,v)})(u.value,n.value,F.value/80)),(t,e)=>{var m,o,v,k,x,B;const a=J,r=Y;return y(),g("div",ne,[i("div",{class:"preview-content",onClick:e[4]||(e[4]=_=>p(O).back())},[i("div",oe,[i("div",ie,[$(A(((m=s.value)==null?void 0:m.description)||((o=s.value)==null?void 0:o.name)||"")+" ",1),i("span",de," ("+A(N((v=s.value)==null?void 0:v.size)||"")+")",1)]),i("div",null,[l(r,{title:"设为相册封面",disabled:((k=s.value)==null?void 0:k.type)!==1,circle:"",onClick:e[0]||(e[0]=_=>T(s.value.mediaId)),plain:"",type:"warning"},{default:d(()=>[l(a,null,{default:d(()=>[l(p(Q))]),_:1})]),_:1},8,["disabled"]),l(r,{circle:"",onClick:e[1]||(e[1]=_=>P()),plain:"",type:"danger"},{default:d(()=>[l(a,null,{default:d(()=>[l(p(ee))]),_:1})]),_:1}),l(r,{circle:"",onClick:e[2]||(e[2]=_=>U()),plain:"",type:"primary"},{default:d(()=>[l(a,null,{default:d(()=>[l(p(te))]),_:1})]),_:1}),l(r,{circle:"",onClick:e[3]||(e[3]=_=>E()),plain:"",type:"success"},{default:d(()=>[l(a,null,{default:d(()=>[l(p(ae))]),_:1})]),_:1})])]),i("div",re,[((x=s.value)==null?void 0:x.type)===1?(y(),g("img",{key:0,src:h(s.value.mediaId),alt:s.value.description},null,8,ce)):((B=s.value)==null?void 0:B.type)===2?(y(),g("video",{key:1,src:h(s.value.mediaId),autoplay:"",muted:"",controls:"",loop:""},[i("source",{src:h(s.value.mediaId),type:"video/mp4"},null,8,ve),i("source",{src:I(s.value.mediaId),type:"video/mp4"},null,8,pe),e[5]||(e[5]=$(" 您的浏览器不支持视频播放。 "))],8,ue)):Z("",!0)]),i("div",{class:"preview-nav preview-prev",onClick:V(D,["stop"])},[l(a,{size:"15"},{default:d(()=>[l(p(se))]),_:1})]),i("div",{class:"preview-nav preview-next",onClick:V(M,["stop"])},[l(a,{size:"15"},{default:d(()=>[l(p(le))]),_:1})])])])}}},ge=H(me,[["__scopeId","data-v-cd418729"]]);export{ge as default};
