import"./Request-Drn82gJH.js";/* empty css                     *//* empty css                 *//* empty css                 */import{a as ne,g as de,d as ie,b as ue}from"./MediaApi-DU0bZU-c.js";import{d as ce,u as re}from"./AlbumApi-CFDiwMIg.js";import{_ as me,r as m,o as ve,B as pe,C as _e,c as d,a as r,e as v,b as s,t as b,w as o,E as fe,d as N,h as ye,F as E,f as B,u as J,g as ge,i as a,k as ke,l as be,m as he,j as c,D as L,G as we,v as Ce,x as Ie,y as xe,H as F,A as g,z as S}from"./index-BnVgF_wZ.js";const Me={style:{padding:"10px"}},Ve={class:"album-header"},Ae={class:"top-area"},Ee={style:{margin:"10px 0 15px 0"}},Be={style:{color:"#6c757d","margin-bottom":"20px"}},Fe={key:0},Se={key:0,class:"batch-actions"},qe={class:"selected-count"},Ue={style:{gap:"5px"}},Re={key:1,class:"media-grid"},De=["onClick"],Te=["src","alt"],Pe={key:0,class:"item-desc"},$e={key:1,class:"media-type"},ze={key:0,class:"el-icon-check"},Ne={key:1},Je={key:0,class:"batch-actions"},Le={class:"selected-count"},Oe={key:1,class:"media-big"},je=["onClick"],Ge=["src","alt"],He={class:"item-desc"},Ke={key:0,class:"media-type"},Qe={key:0,class:"el-icon-check"},We={key:0,class:"collage-view"},Xe={class:"collage-container"},Ye=["src"],Ze=["src"],el={class:"collage-actions"},ll={__name:"AlbumView",setup(tl){const f=m([]),u=m({});ve(()=>{const l=decodeURIComponent(pe().query.album);u.value=JSON.parse(l),n.value=[],p.value=!1,ne(u.value.albumId).then(e=>{f.value=e.data})});const O=()=>{const l=document.documentElement;l.requestFullscreen?l.requestFullscreen():l.mozRequestFullScreen?l.mozRequestFullScreen():l.webkitRequestFullscreen?l.webkitRequestFullscreen():l.msRequestFullscreen&&l.msRequestFullscreen()},h=m("normal"),j=()=>{h.value==="normal"?h.value="big":h.value="normal"};m(null);const G=m([]),w=m(!1),H=()=>{y.value={name:u.value.name,description:u.value.description},w.value=!0},y=m({name:"",description:""}),K=()=>{re(u.value.albumId,y.value.name,y.value.description).then(l=>{l.code===200?(u.value.name=y.value.name,u.value.description=y.value.description,w.value=!1,g.success("更新成功")):g.error(l.message)})},Q=()=>{S.push({name:"UploadMediaView",query:{album:encodeURIComponent(JSON.stringify(u.value))}})},W=_e(()=>!u.value||V.value===null?null:f.value[V.value]),q=m("album-list"),X=m(!1),V=m(0),n=m([]),p=m(!1),Y=()=>{q.value="album-list",u.value=null,p.value=!1,n.value=[]},Z=()=>{n.value=[...f.value]},ee=l=>{V.value=l,S.push({name:"PreviewMediaView",query:{selectedMedia:W.value.mediaId,albumId:u.value.albumId}})},A=()=>{p.value=!p.value,p.value||(n.value=[])},le=l=>{const e=n.value.findIndex(i=>i.mediaId===l.mediaId);e>-1?n.value.splice(e,1):n.value.push(l)},M=l=>n.value.some(e=>e.mediaId===l.mediaId),U=(l,e)=>{p.value?le(l):ee(e)},R=async()=>{g.success(`开始下载选中的 ${n.value.length} 个项目`);const l=8,e=[...n.value];n.value=[];for(let i=0;i<e.length;i+=l){const k=e.slice(i,i+l);await Promise.all(k.map(async C=>{try{const I=se(C.mediaId),_=document.createElement("a");_.href=I,_.download=C.name||"file",_.target="_blank",document.body.appendChild(_),_.click(),document.body.removeChild(_),_.addEventListener("load",()=>{g.success("下载完成")})}catch(I){g.error(`"${C.description||"文件"}" 下载失败`),console.error("下载出错:",I)}}))}n.value=[]},D=()=>{F.confirm(`确定要删除选中的 ${n.value.length} 个项目吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{const l=n.value.map(e=>e.mediaId);n.value=[],ie(l,u.value.albumId).then(e=>{e.code===200?(g.success("删除成功"),f.value=f.value.filter(i=>!l.includes(i.mediaId))):g.error(e.message)}),X.value=!1}).catch(()=>{})},te=()=>{F.confirm(`确定要删除相册 "${u.value.name}" 吗？此操作将删除相册内所有内容。`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{ce(u.value.albumId).then(l=>{l.code===200?(g.success("删除成功"),S.push("/list")):g.error(l.message)})}).catch(()=>{})},T=()=>{if(n.value.length===0){A();return}F.confirm("确定要取消选择么。","取消确认",{confirmButtonText:"确认取消",cancelButtonText:"返回",type:"warning"}).then(()=>{n.value=[],A()}).catch(()=>{})},P=l=>de(l),se=l=>ue(l);return(l,e)=>{const i=ye,k=he,C=be,I=fe,_=we,$=xe,z=Ie,ae=Ce;return a(),d("div",Me,[r("div",null,[r("div",Ve,[r("div",Ae,[r("h2",Ee,b(u.value.name),1),s(I,{placement:"bottom-end"},{dropdown:o(()=>[s(C,null,{default:o(()=>[s(k,{onClick:O},{default:o(()=>e[4]||(e[4]=[c("全屏查看")])),_:1,__:[4]}),s(k,{onClick:A},{default:o(()=>e[5]||(e[5]=[c("批量操作")])),_:1,__:[5]}),s(k,{onClick:j},{default:o(()=>[c(b(h.value==="normal"?"大":"小")+"图模式 ",1)]),_:1}),s(k,{onClick:H},{default:o(()=>e[6]||(e[6]=[c("编辑相册")])),_:1,__:[6]}),s(k,{onClick:te},{default:o(()=>e[7]||(e[7]=[c("删除相册")])),_:1,__:[7]}),s(k,{onClick:Q},{default:o(()=>e[8]||(e[8]=[c("上传相册")])),_:1,__:[8]})]),_:1})]),default:o(()=>[s(i,{icon:J(ke),plain:"",type:"primary"},null,8,["icon"])]),_:1})]),r("p",Be,b(u.value.description),1)]),h.value==="normal"?(a(),d("div",Fe,[p.value?(a(),d("div",Se,[r("div",qe," 已选 "+b(n.value.length),1),r("div",Ue,[s(i,{type:"warning",onClick:Z},{default:o(()=>e[9]||(e[9]=[c(" 全选 ")])),_:1,__:[9]}),s(i,{type:"success",disabled:n.value.length===0,onClick:R},{default:o(()=>e[10]||(e[10]=[c(" 下载 ")])),_:1,__:[10]},8,["disabled"]),s(i,{type:"danger",disabled:n.value.length===0,onClick:D},{default:o(()=>e[11]||(e[11]=[c(" 删除 ")])),_:1,__:[11]},8,["disabled"]),s(i,{type:"primary",onClick:T},{default:o(()=>e[12]||(e[12]=[c(" 取消 ")])),_:1,__:[12]})])])):v("",!0),f.value.length>0?(a(),d("div",Re,[(a(!0),d(E,null,B(f.value,(t,x)=>(a(),d("div",{key:t.mediaId,class:"media-item",onClick:oe=>U(t,x)},[r("img",{src:P(t.mediaId),alt:t.description},null,8,Te),t.type===2?(a(),d("div",Pe,b(t.description||""),1)):v("",!0),t.type===2?(a(),d("div",$e," 视频 ")):v("",!0),p.value?(a(),d("div",{key:2,class:L(["select-indicator",{selected:M(t)}])},[M(t)?(a(),d("i",ze)):v("",!0)],2)):v("",!0)],8,De))),128))])):(a(),N(_,{key:2}))])):h.value==="big"?(a(),d("div",Ne,[p.value?(a(),d("div",Je,[r("div",Le," 已选 "+b(n.value.length),1),r("div",null,[s(i,{type:"success",disabled:n.value.length===0,onClick:R},{default:o(()=>e[13]||(e[13]=[c(" 下载 ")])),_:1,__:[13]},8,["disabled"]),s(i,{type:"danger",disabled:n.value.length===0,onClick:D},{default:o(()=>e[14]||(e[14]=[c(" 删除 ")])),_:1,__:[14]},8,["disabled"]),s(i,{type:"primary",onClick:T},{default:o(()=>e[15]||(e[15]=[c(" 取消 ")])),_:1,__:[15]})])])):v("",!0),f.value.length>0?(a(),d("div",Oe,[(a(!0),d(E,null,B(f.value,(t,x)=>(a(),d("div",{key:t.mediaId,class:"media-item-big",onClick:oe=>U(t,x)},[r("img",{src:P(t.mediaId),alt:t.description},null,8,Ge),r("div",He,b(t.description||""),1),t.type===2?(a(),d("div",Ke," 视频 ")):v("",!0),p.value?(a(),d("div",{key:1,class:L(["select-indicator",{selected:M(t)}])},[M(t)?(a(),d("i",Qe)):v("",!0)],2)):v("",!0)],8,je))),128))])):(a(),N(_,{key:2}))])):v("",!0)]),q.value==="collage"?(a(),d("div",We,[r("div",Xe,[(a(!0),d(E,null,B(G.value,(t,x)=>(a(),d("div",{key:x,class:"collage-item"},[t.type==="image"?(a(),d("img",{key:0,src:t.url,alt:""},null,8,Ye)):(a(),d("video",{key:1,src:t.url,muted:"",autoplay:"",controls:""},null,8,Ze))]))),128))]),r("div",el,[s(i,{type:"primary",onClick:Y},{default:o(()=>e[16]||(e[16]=[c("返回")])),_:1,__:[16]})])])):v("",!0),s(J(ge),{style:{width:"90%","max-width":"600px","z-index":"999"},modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=t=>w.value=t),title:"编辑相册"},{footer:o(()=>[s(i,{onClick:e[2]||(e[2]=t=>w.value=!1)},{default:o(()=>e[17]||(e[17]=[c("取消")])),_:1,__:[17]}),s(i,{type:"primary",onClick:K},{default:o(()=>e[18]||(e[18]=[c("保存")])),_:1,__:[18]})]),default:o(()=>[s(ae,{"label-width":"80px"},{default:o(()=>[s(z,{label:"名称"},{default:o(()=>[s($,{modelValue:y.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value.name=t)},null,8,["modelValue"])]),_:1}),s(z,{label:"描述"},{default:o(()=>[s($,{modelValue:y.value.description,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value.description=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},cl=me(ll,[["__scopeId","data-v-135b12f9"]]);export{cl as default};
